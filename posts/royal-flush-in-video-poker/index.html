<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Getting a Royal Flush in Video Poker</title><meta name=description content="What is the probability of getting a Royal Flush in GTA's &#34;Video Poker&#34; casino game?"><meta name=keywords content="blog,gokarna,hugo,math"><meta property="og:url" content="https://filipre.github.io/posts/royal-flush-in-video-poker/"><meta property="og:type" content="website"><meta property="og:title" content="Getting a Royal Flush in Video Poker"><meta property="og:description" content="What is the probability of getting a Royal Flush in GTA's &#34;Video Poker&#34; casino game?"><meta property="og:image" content="https://filipre.github.io/images/avatar.png"><meta property="og:image:secure_url" content="https://filipre.github.io/images/avatar.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Getting a Royal Flush in Video Poker"><meta name=twitter:description content="What is the probability of getting a Royal Flush in GTA's &#34;Video Poker&#34; casino game?"><meta property="twitter:domain" content="https://filipre.github.io/posts/royal-flush-in-video-poker/"><meta property="twitter:url" content="https://filipre.github.io/posts/royal-flush-in-video-poker/"><meta name=twitter:image content="https://filipre.github.io/images/avatar.png"><link rel=canonical href=https://filipre.github.io/posts/royal-flush-in-video-poker/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.edd985581bf860dfb4507e5885197f1680160c7fe19f23b31e183126d99dd596.js integrity="sha256-7dmFWBv4YN+0UH5YhRl/FoAWDH/hnyOzHhgxJtmd1ZY="></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://filipre.github.io/><img src=/images/avatar.png alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://filipre.github.io/>René's Blog</a></div><div class=nav-links><div class=nav-link><a href=https://filipre.github.io/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://filipre.github.io/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://filipre.github.io/contact><span data-feather=mail></span> Contact</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://filipre.github.io/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://filipre.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://filipre.github.io/contact><span data-feather=mail></span> Contact</a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Getting a Royal Flush in Video Poker</h1><small role=doc-subtitle>What is the probability of getting a Royal Flush in GTA's "Video Poker" casino game?</small><p class=post-date>21 January, 2018</p><ul class=post-tags><li class=post-tag><a href=https://filipre.github.io/tags/math>math</a></li></ul></div><div class=post-content><p><p>Some months ago I came across the Twitch streamer <a href=https://twitch.tv/joshimuz>Joshimuz</a> who has quite an interesting project: He tries to play through GTA San Andreas by solving <em>everything</em>. Not only he tries to achieve 100 % but he also set his own goals and challenges. At the same time, he gives insights into a lot of (speed running) techniques, interesting bugs and a little bit of game development. If you like content like that, you should definitely check out his video series <a href="https://www.youtube.com/watch?v=FlOQslp4MQA">True 100%+</a> on Youtube.</p><p>Anyway, one of his goals is to get a Royal Flush in GTA&rsquo;s <a href=https://en.wikipedia.org/wiki/Video_poker>video poker</a>. Like in normal video poker, you get 5 cards and you decide which cards you want to keep. Then, you get new cards and depending on what kind of hand you have, you get some amount of money or nothing at all. Obviously, a Royal Flush gives you the most money but is also the least likely outcome. You can watch his first attempts <a href="https://youtu.be/NU8m18HO35o?start=1468">here</a>.</p><p>I wondered, how much does he have to play to get a Royal Flush? How likely (in terms of probability) is it if he uses the best strategy?</p><h2 id=tldr>tl;dr</h2><p>By using the best strategy, the probability of getting a Royal Flush is about <strong>0.0043 %</strong> which means, <em>it&rsquo;s expected</em> that he plays around <strong>23081</strong> games of video poker.</p><p>Furthermore, we can provide the amount of games needed for getting a Royal Flush with a certain probability. For example: It&rsquo;s 50 % likely that Joshimuz gets a Royal Flush if he plays 15998 games. On the other hand, there is a 1 % chance that he might not get a Royal Flush even after 106288 games.</p><table><thead><tr><th>p</th><th>n</th></tr></thead><tbody><tr><td>1 %</td><td>232</td></tr><tr><td>10 %</td><td>2432</td></tr><tr><td>25 %</td><td>6640</td></tr><tr><td>50 %</td><td>15998</td></tr><tr><td>75 %</td><td>31996</td></tr><tr><td>90 %</td><td>53144</td></tr><tr><td>99 %</td><td>106288</td></tr></tbody></table><p>If you are interested on how to derive these results, read on!</p><h2 id=video-poker>Video Poker</h2><p>Video poker uses a standard deck of 52 cards, i.e. the lowest cards are <strong>2</strong> ♣️, <strong>2</strong> ♠️, <strong>2</strong> ♥️, <strong>2</strong> ♦️ and the highest cards are <strong>A</strong> ♣️, <strong>A</strong> ♠️, <strong>A</strong> ♥️, <strong>A</strong> ♦️. A Royal Flush is the highest street possible in the same suit. Therefore, there are four possible Royal Flushes, namely:</p><ul><li><strong>10</strong> ♣️ <strong>J</strong> ♣️ <strong>Q</strong> ♣️ <strong>K</strong> ♣️ <strong>A</strong> ♣️</li><li><strong>10</strong> ♠️ <strong>J</strong> ♠️ <strong>Q</strong> ♠️ <strong>K</strong> ♠️ <strong>A</strong> ♠️</li><li><strong>10</strong> ♥️ <strong>J</strong> ♥️ <strong>Q</strong> ♥️ <strong>K</strong> ♥️ <strong>A</strong> ♥️</li><li><strong>10</strong> ♦️ <strong>J</strong> ♦️ <strong>Q</strong> ♦️ <strong>K</strong> ♦️ <strong>A</strong> ♦️</li></ul><p>We will call these cards &ldquo;potential cards&rdquo;.</p><p>For every video poker game, the player receives 5 random cards from the deck. He then can choose what he thinks are the best cards to keep and which cards should be thrown away. After that, the player receives new cards until he has 5 again and the dealer (i.e. the slot machine) evaluates the highest hand. In this problem we are not interested in getting any other winning hand like a &ldquo;Full House&rdquo; or &ldquo;Three of a Kind&rdquo;. Notice that you can also adjust your wagger and that there are many varieties of video poker but this not really interesting to us either.</p><h2 id=best-strategy>Best Strategy</h2><p>It is quite obvious that the best strategy for getting a Royal Flush is to keep potential cards (listed above) and to throw useless ones away. Sometimes, there are multiple potential cards but in different suits. Again, it&rsquo;s very easy to see that we should keep the suit that has more potential cards in that suit then the other. If the number is equal (for example if we have a hand like <strong>10</strong> ♥️ <strong>J</strong> ♥️ <strong>K</strong> ♣️ <strong>A</strong> ♣️ <strong>5</strong> ♥️) then it does not matter if we keep ♥️ or ♣️ because both Royal Flushes come with the same probability.</p><p>In this post, we are not going to formally prove that this greedy strategy maximises our chances but I believe it should not be <a href=https://web.stanford.edu/class/archive/cs/cs161/cs161.1138/handouts/120%20Guide%20to%20Greedy%20Algorithms.pdf>too</a> <a href=http://www.cs.cornell.edu/courses/cs482/2003su/handouts/greedy_exchange.pdf>hard</a>.</p><p>You can take a look at the implementation of this strategy in the <code>holdCards(hand)</code> method at the very end.</p><h2 id=calculation-of-the-probability>Calculation of the Probability</h2><p>Let $R$ denote the <a href=https://en.wikipedia.org/wiki/Event_(probability_theory)>event</a> of a Royal Flush and $\Omega$ denote the set of all possible outcomes of drawing 5 cards from a standard deck. From the section above it&rsquo;s clear that there are $\vert R\vert = 4$ possible Royal Flushes. If we know the size of our sample space $\Omega$, i.e. how many ways there are to sample 5 cards from a 52 deck, we can easily calculate the probability by utilising this formula:</p><p>$$ \Pr(\text{event}) = \frac{\text{number of outcomes in event}}{\text{number of outcomes in sample space}} $$</p><p>Luckily, there exists the <a href=https://en.wikipedia.org/wiki/Binomial_coefficient>Binomial Coefficient</a> $\binom{n}{k}$ that gives us the number of possibilities of choosing $k$ elements from a set of size $n$ without respecting the order. Here, we have $n = 52$ cards and we choose $k = 5$ cards from them. By employing the formula above we get</p><p>$$ \Pr(R) = \frac{|R|}{|\Omega|} = \frac{4}{\binom{52}{5}} = \frac{1}{649740} \approx 0.00015% $$</p><p>However, our problem is a bit more complicated because we completely neglected that we can optimise our chances by keeping potential cards. So far we only calculated the probability of getting a Royal Flush when we are not allowed to keep cards. From now, $R$ will refer to the <em>actual</em> problem and not to this simple one.</p><h3 id=law-of-total-probability-random-variables->Law of Total Probability, Random Variables, &mldr;</h3><p>As it turns out, we need to divide our event $R$ into smaller disjoint subsets. The intuition behind doing that is that it is much more likely to get a Royal Flush if the player keeps 4 potential cards in the same suit than keeping only one or two. However, drawing 4 potential cards in the same suit in the first place is much less likely than getting maybe only one. By splitting up $R$ we can exactly describe this observation mathematically. This trick is known as the <a href=https://en.wikipedia.org/wiki/Law_of_total_probability>Law of total probability</a>:</p><p>$$ \Pr(A) = \sum_n \Pr(B_n) \cdot \Pr(A ;\vert; B_n) $$</p><p>I will shortly explain what the bar inside $\Pr(A ;\vert; B_n)$ means, but first, we also have to change our notation a bit by using <a href=https://en.wikipedia.org/wiki/Random_variable>Random Variables</a>. A Random Variable is usually a function $X\colon \Omega \to \mathbb{R}$ that maps events to natural numbers. That way, we can describe events more easily and work with them. Let $X$ be a Random Variable that denotes the number of cards a player exactly kept by using the described strategy. It&rsquo;s clear that the kept cards are all equal or above the rank <strong>10</strong> and all have the same suit. In addition, $X$ can only take values between 0 (not keeping any cards) and 5 (keeping all cards, aka. a Royal Flush). To refer to the probability of getting a Royal Flush <em>if the player already holds 3 cards</em>, we write</p><p>$$\Pr(R;\vert;X=3)$$</p><p>Probabilities that come with a <em>condition</em> are called <a href=https://en.wikipedia.org/wiki/Conditional_probability>Conditional Probabilities</a> where the condition is written after the bar $\vert$. Here we used the notation involving the Random Variable $X$. If we want to refer to the probability of being able to keep three cards in the first place, we would write</p><p>$$\Pr(X=3)$$</p><p>Notice that it means something completely different. It should not be too hard to see that</p><p>$$0 &lt; \Pr(R;\vert;X=0) &lt; \Pr(R;\vert;X=1) &lt; \dotsb &lt; \Pr(R;\vert;X=5) = 1$$</p><p>but</p><p>$$1 > \Pr(X=0) > \Pr(X=1) > \dotsb > \Pr(X=5) > 0$$</p><p>Since we said that $X$ <em>exactly</em> represents the number of kept cards in a game, the associated events are disjoint and we can apply the Law of Total Probability:</p><p>$$\Pr(R) = \sum_{x=0}^5 \Pr(X=x) \cdot \Pr(R ;\vert; X=x)$$</p><p>So if we find out how to calculate $\Pr(X=x)$ and $\Pr(R ;\vert; X=x)$ for a given $x$, we are done! We will start with the easier factor $\Pr(R ;\vert; X=x)$.</p><h3 id=suppose-we-already-hold-cards>Suppose we already hold cards&mldr;</h3><p>Surely there are only $52-5$ cards left in deck, our hand has $x$ cards and we need to draw the remaining $5-x$ cards to have a full hand again. This sounds exactly like the situation at the very beginning but now, $n$ is $52-5=47$ and $k$ is $5-x$. Additionally, we need to think about the number of outcomes in the Royal Flush event $R$ depending on $x$. If we don&rsquo;t hold any card, we did not get any potential card and we could still draw any of the four possible Royal Flushes with the remaining $47$ cards in the deck. But, if we save at least one card, there is only one possible Royal Flush left since we sort of &ldquo;decided&rdquo; on a suit already. Therefore</p><p>$$\Pr(R ;\vert; X=x) = \begin{cases}
\frac{4}{\binom{52-5}{5}} &\text{if } x=0 \
\frac{1}{\binom{52-5}{5-x}} &\text{otherwise}
\end{cases}$$</p><p>It&rsquo;s always a good idea to test a model for some edge cases to detect errors. We would expect that if we keep $x=5$ cards, we <em>must</em> have a Royal Flush. Indeed this is true:</p><p>$\Pr(R ;\vert; X=5) = \frac{1}{\binom{52-5}{5-5}} = \frac{1}{\binom{47}{0}} = \frac{1}{1} = 1$</p><p>Let&rsquo;s tackle $\Pr(X=x)$.</p><h3 id=one-random-variable-is-not-enough>One Random Variable is not enough</h3><p>It looked easier than it was to be honest, because we have to make sure that we don&rsquo;t count some events twice or not at all. For example, suppose we have a hand (outcome) like this:</p><p>It&rsquo;s important that this outcome only <em>counts</em> when $x = 3$ and not $x = 2$. Otherwise, our subsets would not be disjoint and we could not apply the Law of Total Probability. But a lot of the simpler approaches and formulas just don&rsquo;t care about that and manually excluding situations like these is error prone and not convincing. This problem does not occur in the previous section because we throw cards away.</p><p>Instead, we split up $R$ now a bit differently to be able to use a more systematic approach. Let $X$ still be the Random Variable that keeps track of the number of cards a player wants to hold. Now, let $A$ be a Random Variable that notes the number of potential cards in the current hand <em>of a different suit</em> than the cards being tracked by $X$. In the hand above, we would have an event where $X=3$ and $A=2$. Let $B$ and $C$ be Random Variables too, where the former represents the third different suit and the latter represents the fourth different suit. Since the hand above does not have a third or fourth suit, we simply have $B=0$ and $C=0$. Also notice the number of non-potential cards is $5-X-A-B-C$, i.e. simply the rest.</p><p>By using only $X$, $A$, $B$ and $C$ we can describe any relevant event for us, but first, we must enforce additional constraints to make all events disjoint: First, we must not exceed 5 cards on a hand and second, there must be an ordering of the Random Variables because we have to make sure that we do not get accidentally a better hand by not saving $X$ cards.</p><ol><li>Constraint: $X+A+B+C \le 5$</li><li>Constraint: $X \ge A \ge B \ge C \ge 0$</li></ol><p>Let&rsquo;s give some examples to make it clearer.</p><table><thead><tr><th>$X$</th><th>$A$</th><th>$B$</th><th>$C$</th><th>Example Hand</th><th>Valid?</th></tr></thead><tbody><tr><td>2</td><td>1</td><td>0</td><td>0</td><td><strong>6</strong> ♦️ <strong>9</strong> ♥️ <strong>Q</strong> ♣️ <strong>K</strong> ♣️ <strong>K</strong> ♠️</td><td>yes</td></tr><tr><td>1</td><td>1</td><td>1</td><td>1</td><td><strong>5</strong> ♣️ <strong>10</strong> ♣️ <strong>10</strong> ♥️ <strong>A</strong> ♦️ <strong>A</strong> ♠️</td><td>yes</td></tr><tr><td>5</td><td>0</td><td>0</td><td>0</td><td><strong>10</strong> ♥️ <strong>J</strong> ♥️ <strong>Q</strong> ♥️ <strong>K</strong> ♥️ <strong>A</strong> ♥️</td><td>yes</td></tr><tr><td>4</td><td>2</td><td>0</td><td>0</td><td><strong>10</strong> ♥️ <strong>J</strong> ♥️ <strong>Q</strong> ♥️ <strong>Q</strong> ♣️ <strong>K</strong> ♦️ <strong>K</strong> ♥️</td><td>no, violates constraint 1</td></tr><tr><td>2</td><td>3</td><td>0</td><td>0</td><td><strong>10</strong> ♣️ <strong>J</strong> ♣️ <strong>Q</strong> ♠️ <strong>K</strong> ♠️ <strong>A</strong> ♠️</td><td>no, violates constraint 2</td></tr></tbody></table><p>We need to rewrite $\Pr(R)$ though since we are dealing with new Random Variables now:</p><p>$$ \Pr(R) = \sum_{\scriptstyle x+a+b+c \le 5\atop\scriptstyle x \ge a \ge b \ge c \ge 0} \Pr(X=x, A=a, B=b, C=c) \cdot \Pr(R ;\vert; X=x, A=a, B=b, C=c) $$</p><p>So do we have to throw $\Pr(R ;\vert; X=x)$ away, because it does not take $A$, $B$ and $C$ into account? No we don&rsquo;t! Since we throw the cards tracked by $A$, $B$ and $C$ away <em>anyway</em>, the probability of getting a Royal Flush does not <a href=https://en.wikipedia.org/wiki/Independence_(probability_theory)>depend</a> on them and we do have</p><p>$$ \Pr(R ;\vert; X=x, A=a, B=b, C=c) = \Pr(R ;\vert; X=x) $$</p><p>The big question is, how do we calculate $\Pr(X=x, A=a, B=b, C=c)$? To do this, again, we need to think about the number of outcomes in the event and the number of outcomes in the sample space.</p><h3 id=more-combinatorics>More combinatorics</h3><p>The size of our sample space $\Omega$ is $\binom{52}{5}$ again since we start with a fresh deck and then draw 5 cards from it.</p><p>To determine the number of outcomes in the event $X=x, A=a, B=b, C=c$, we need to consider all different combinations of suits together with all different combinations of ranks. To make it easier first, let&rsquo;s fix the Random Variables to one specific suit: $X$ tracks ♣️, $A$ tracks ♠️, $B$ tracks ♥️ and $C$ tracks ♦️. Let $r(x, a, b, c)$ represent the number of different rank combinations. If suits are fixed,</p><p>$$ \Pr(X=x, A=a, B=b, C=c) = \frac{r(x, a, b, c)}{\binom{52}{5}} $$</p><p>Finding a term for $r(x, a, b, c)$ is easy. Think about you have 5 different decks:</p><ul><li>5 potential cards of suit ♣️</li><li>5 potential cards of suit ♠️</li><li>5 potential cards of suit ♥️</li><li>5 potential cards of suit ♦️</li><li>32 other (useless) cards of any suit</li></ul><p>Now we draw $x$ cards from the ♣️ deck, $a$ cards from the ♠️ deck, $b$ cards from the ♥️ deck, $c$ cards from the ♦️ deck and the missing $5-x-a-b-c$ cards from the other cards:</p><p>$$ r(x, a, b, c) = \binom{5}{x} \cdot \binom{5}{a} \cdot \binom{5}{b} \cdot \binom{5}{c} \cdot \binom{32}{5-x-a-b-c} $$</p><p>Sadly (luckily?), our Random Variables can track any suit and it only matters, that two Random Variables do not track the same suit at the same time. Therefore, we have to calculate $r(x, a, b, c)$ for any possible suit as well. Let $s(x, a, b, c)$ denote the number of suit combinations. We then can simply multiply those two terms.</p><p>$$ \Pr(X=x, A=a, B=b, C=c) = \frac{ s(x, a, b, c) \cdot r(x, a, b, c)}{\binom{52}{5}} $$</p><p>Finding a nice term for $s(x, a, b, c)$ is a bit more tricky, but there are some observations: At first, we have four different possibilities to assign a suit to $X$. Because $A$ has to be a different suit than $X$, there are only three possibilities left. The same applies for $B$ and once we assigned suits to $X$, $A$ and $B$ already, there is only one possibility left for $C$. If our event consists of only two suits, we simply neglect the possibilities for the other two suits. In the equation below, $H(x)$ is a &ldquo;left-continuous&rdquo; <a href=https://en.wikipedia.org/wiki/Heaviside_step_function>Heaviside step function</a> that is $0$ if $x$ is $0$ and is $1$ if $x>0$.</p><p>$$ s(x, a, b, c) = \frac{4^{H(x)} \cdot 3^{H(a)} \cdot 2^{H(b)} \cdot 1^{H(c)}}{g(x, a, b, c)} $$</p><p>So what is $g(x, a, b, c)$ doing? The enumerator <em>sometimes</em> counts suit combinations twice or more times but <em>sometimes</em> does not. On the one hand, the event $X=2, A=1, B=0, C=0$ has following combinations:</p><p><strong>[</strong> ♣️ ♣️ ♠️ <strong>]</strong>, <strong>[</strong> ♣️ ♣️ ♥️ <strong>]</strong>, <strong>[</strong> ♣️ ♣️ ♦️ <strong>]</strong>, <strong>[</strong> ♠️ ♠️ ♣️ <strong>]</strong>, <strong>[</strong> ♠️ ♠️ ♥️ <strong>]</strong>, <strong>[</strong> ♠️ ♠️ ♦️ <strong>]</strong>, <strong>[</strong> ♥️ ♥️ ♣️ <strong>]</strong>, <strong>[</strong> ♥️ ♥️ ♠️ <strong>]</strong>, <strong>[</strong> ♥️ ♥️ ♦️ <strong>]</strong>, <strong>[</strong> ♦️ ♦️ ♣️ <strong>]</strong>, <strong>[</strong> ♦️ ♦️ ♠️ <strong>]</strong>, <strong>[</strong> ♦️ ♦️ ♥️ <strong>]</strong></p><p>On the other hand, the event $X=1, A=1, B=0, C=0$ has much fewer:</p><p><strong>[</strong> ♣️ ♠️ <strong>]</strong>, <strong>[</strong> ♣️ ♥️ <strong>]</strong>, <strong>[</strong> ♣️ ♦️ <strong>]</strong>, <strong>[</strong> ♠️ ♥️ <strong>]</strong>, <strong>[</strong> ♠️ ♦️ <strong>]</strong>, <strong>[</strong> ♥️ ♦️ <strong>]</strong></p><p>If two/three/four Random Variables share the same number as others and are at least $1$ (here: $A = X = 1$), we need to remove additional counted outcomes due to permutations. We do this by using <a href=https://en.wikipedia.org/wiki/Factorial>factorials</a>. $n!$ is the number of ways how to permute $n$ elements. For instance $n=3$, we would get $n! = 3 \cdot 2 \cdot 1 = 6$ different ways to permute three suits:</p><p><strong>[</strong> ♣️ ♠️ ♥️ <strong>]</strong>, <strong>[</strong> ♣️ ♥️ ♠️ <strong>]</strong>, <strong>[</strong> ♠️ ♣️ ♥️ <strong>]</strong>, <strong>[</strong> ♠️ ♥️ ♣️ <strong>]</strong>, <strong>[</strong> ♥️ ♣️ ♠️ <strong>]</strong>, <strong>[</strong> ♥️ ♠️ ♣️ <strong>]</strong></p><p>The easiest way to find out $g(x, a, b, c)$ is to simply go through every valid assignment for $X=x, A=a, B=b, C=c$ and think about it directly. In many cases it is just 1.</p><table><thead><tr><th>Example</th><th>$C$</th><th>$B$</th><th>$A$</th><th>$X$</th><th>$g$</th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♣️</td><td>0</td><td>0</td><td>0</td><td>1</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♣️ ♠️</td><td>0</td><td>0</td><td>1</td><td>1</td><td>2</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♣️ ♠️ ♥️</td><td>0</td><td>1</td><td>1</td><td>1</td><td>6</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♣️ ♠️ ♥️ ♦️</td><td>1</td><td>1</td><td>1</td><td>1</td><td>24</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♦️ ♦️</td><td>0</td><td>0</td><td>0</td><td>2</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♦️ ♦️ ♣️</td><td>0</td><td>0</td><td>1</td><td>2</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♦️ ♦️ ♣️ ♠️</td><td>0</td><td>1</td><td>1</td><td>2</td><td>2</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♦️ ♦️ ♣️ ♠️ ♥️</td><td>1</td><td>1</td><td>1</td><td>2</td><td>6</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♦️ ♦️ ♥️ ♥️</td><td>0</td><td>0</td><td>2</td><td>2</td><td>2</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♦️ ♦️ ♠️ ♠️ ♣️</td><td>0</td><td>1</td><td>2</td><td>2</td><td>2</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♠️ ♠️ ♠️</td><td>0</td><td>0</td><td>0</td><td>3</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♠️ ♠️ ♠️ ♦️</td><td>0</td><td>0</td><td>1</td><td>3</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♠️ ♠️ ♠️ ♦️ ♣️</td><td>0</td><td>1</td><td>1</td><td>3</td><td>2</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♠️ ♠️ ♠️ ♦️ ♦️</td><td>0</td><td>0</td><td>2</td><td>3</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♥️ ♥️ ♥️ ♥️</td><td>0</td><td>0</td><td>0</td><td>4</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♥️ ♥️ ♥️ ♥️ ♣️</td><td>0</td><td>0</td><td>1</td><td>4</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>♣️ ♣️ ♣️ ♣️ ♣️</td><td>0</td><td>0</td><td>0</td><td>5</td><td>1</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>We are finally in a position where we can calculate $\Pr(X=x, A=a, B=b, C=c)$! Let&rsquo;s do it:</p><table><thead><tr><th>Example</th><th>$C$</th><th>$B$</th><th>$A$</th><th>$X$</th><th>$\Pr(X=x, A=a, B=b, C=c)$</th></tr></thead><tbody><tr><td></td><td>0</td><td>0</td><td>0</td><td>0</td><td>7.75 %</td></tr><tr><td>♣️</td><td>0</td><td>0</td><td>0</td><td>1</td><td>27.67 %</td></tr><tr><td>♣️ ♠️</td><td>0</td><td>0</td><td>1</td><td>1</td><td>28.63 %</td></tr><tr><td>♣️ ♠️ ♥️</td><td>0</td><td>1</td><td>1</td><td>1</td><td>9.54 %</td></tr><tr><td>♣️ ♠️ ♥️ ♦️</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0.77 %</td></tr><tr><td>♦️ ♦️</td><td>0</td><td>0</td><td>0</td><td>2</td><td>7.63 %</td></tr><tr><td>♦️ ♦️ ♣️</td><td>0</td><td>0</td><td>1</td><td>2</td><td>11.45 %</td></tr><tr><td>♦️ ♦️ ♣️ ♠️</td><td>0</td><td>1</td><td>1</td><td>2</td><td>3.69 %</td></tr><tr><td>♦️ ♦️ ♣️ ♠️ ♥️</td><td>1</td><td>1</td><td>1</td><td>2</td><td>0.19 %</td></tr><tr><td>♦️ ♦️ ♥️ ♥️</td><td>0</td><td>0</td><td>2</td><td>2</td><td>0.74 %</td></tr><tr><td>♦️ ♦️ ♠️ ♠️ ♣️</td><td>0</td><td>1</td><td>2</td><td>2</td><td>0.23 %</td></tr><tr><td>♠️ ♠️ ♠️</td><td>0</td><td>0</td><td>0</td><td>3</td><td>0.76 %</td></tr><tr><td>♠️ ♠️ ♠️ ♦️</td><td>0</td><td>0</td><td>1</td><td>3</td><td>0.74 %</td></tr><tr><td>♠️ ♠️ ♠️ ♦️ ♣️</td><td>0</td><td>1</td><td>1</td><td>3</td><td>0.12 %</td></tr><tr><td>♠️ ♠️ ♠️ ♦️ ♦️</td><td>0</td><td>0</td><td>2</td><td>3</td><td>0.05 %</td></tr><tr><td>♥️ ♥️ ♥️ ♥️</td><td>0</td><td>0</td><td>0</td><td>4</td><td>0.02 %</td></tr><tr><td>♥️ ♥️ ♥️ ♥️ ♣️</td><td>0</td><td>0</td><td>1</td><td>4</td><td>0.01 %</td></tr><tr><td>♣️ ♣️ ♣️ ♣️ ♣️</td><td>0</td><td>0</td><td>0</td><td>5</td><td>0.0002 %</td></tr><tr><td><strong>Sum</strong></td><td></td><td></td><td></td><td></td><td>100 %</td></tr></tbody></table><p>We quickly confirm our calculation by summing up all $p(X=x, A=a, B=b, C=c)$. If we would not get $1$ back, that would mean some events count outcomes too much or not at all.</p><p>$$ \sum_{\scriptstyle x+a+b+c \le 5\atop\scriptstyle x \ge a \ge b \ge c \ge 0} p(X=x, A=a, B=b, C=c) = 1 $$</p><p>We are almost done.</p><h3 id=putting-everything-together>Putting everything together</h3><p>Since I also wanted to know $\Pr(X=x)$, I simply added all disjoint subset satisfying $X=x$ together, like this:</p><p>$$\Pr(X=4) = \Pr(X=4, A=0, B=0, C=0) + \Pr(X=4, A=1, B=0, C=0)$$</p><p>These are my results</p><table><thead><tr><th>Example</th><th>$X$</th><th>$\Pr(X=x)$</th><th>$\Pr(R ;\vert; X=x)$</th></tr></thead><tbody><tr><td></td><td>0</td><td>7.75 %</td><td>0.0003 %</td></tr><tr><td>♦️</td><td>1</td><td>66.61 %</td><td>0.001 %</td></tr><tr><td>♣️ ♣️</td><td>2</td><td>23.94 %</td><td>0.01 %</td></tr><tr><td>♥️ ♥️ ♥️</td><td>3</td><td>1.66 %</td><td>0.09 %</td></tr><tr><td>♠️ ♠️ ♠️ ♠️</td><td>4</td><td>0.04 %</td><td>2.13 %</td></tr><tr><td>♦️ ♦️ ♦️ ♦️ ♦️</td><td>5</td><td>0.0002 %</td><td>100 %</td></tr><tr><td><strong>Sum</strong></td><td></td><td>100 %</td><td></td></tr></tbody></table><p>Finally, by using Law of Total Probability:</p><p>$$ \Pr(R) = \sum_{x=0}^5 \Pr(X=x) \cdot \Pr(R ;\vert; X=x) \approx \frac{1}{23081} \approx 0.0043 % $$</p><h3 id=number-of-expected-games-and-more>Number of expected games and more</h3><p>Let $E$ denote the expected number of games we need to play until we get a Royal Flush. If we get one, we stop. Otherwise we try again. Read <a href=https://math.stackexchange.com/questions/42930/what-is-the-expected-value-of-the-number-of-die-rolls-necessary-to-get-a-specifi>this</a> for details.</p><p>$$ E = 1 + \frac{23080}{23081} \cdot E \Rightarrow E = 23081$$</p><p>This does not tell us that much because it rather means, <em>on average</em> we need 23081 games. However, I am pretty sure we don&rsquo;t want to get Royal Flushes a second or third time. There is something else we can do: We could provide a probability $p$ on how likely it is that we get a Royal Flush in the first $n$ tries.</p><p>With the help of <a href=https://en.wikipedia.org/wiki/Complementary_event>complementary events</a> we solve for $n$:</p><p>$$p = 1 - (1-\Pr(R))^n \Leftrightarrow 1-p = (1-\Pr(R))^n \Leftrightarrow \ln{(1-p)} = n \ln{(1-\Pr(R))}$$</p><p>$ \Leftrightarrow n = \frac{\ln(1-p)}{\ln(1-\Pr(R))} $</p><p>I think this table describes much better how much effort Josh might have to put into his project.</p><table><thead><tr><th>p</th><th>n</th></tr></thead><tbody><tr><td>1%</td><td>232</td></tr><tr><td>10%</td><td>2432</td></tr><tr><td>25%</td><td>6640</td></tr><tr><td>50%</td><td>15998</td></tr><tr><td>75%</td><td>31996</td></tr><tr><td>90%</td><td>53144</td></tr><tr><td>99%</td><td>106288</td></tr></tbody></table><h2 id=empirical-validation>Empirical Validation</h2><p>To confirm the theory, I wrote a small Python script that simulates getting a Royal Flush 10000 times. After 4h on my MacBook, the probability was $0.0042%$, which is not too far away from $0.0043 %$. You can find the code below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pcards <span style=color:#f92672>import</span> Deck, Card
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> itertools <span style=color:#f92672>import</span> chain, combinations
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> joblib <span style=color:#f92672>import</span> Parallel, delayed
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> multiprocessing
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> statistics <span style=color:#f92672>import</span> mean
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://docs.python.org/2.7/library/itertools.html#recipes</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>powerset</span>(iterable):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;powerset([1,2,3]) --&gt; () (1,) (2,) (3,) (1,2) (1,3) (2,3) (1,2,3)&#34;</span>
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> list(iterable)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> chain<span style=color:#f92672>.</span>from_iterable(combinations(s, r) <span style=color:#66d9ef>for</span> r <span style=color:#f92672>in</span> range(len(s)<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>printHand</span>(hand):
</span></span><span style=display:flex><span>    [print(card) <span style=color:#66d9ef>for</span> card <span style=color:#f92672>in</span> hand]
</span></span><span style=display:flex><span>    print()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>drawInitial</span>(deck):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> deck<span style=color:#f92672>.</span>draw(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>holdCards</span>(hand):
</span></span><span style=display:flex><span>    high_cards <span style=color:#f92672>=</span> [card <span style=color:#66d9ef>for</span> card <span style=color:#f92672>in</span> hand <span style=color:#66d9ef>if</span> card<span style=color:#f92672>.</span>rank() <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>10</span>]
</span></span><span style=display:flex><span>    handPowerset <span style=color:#f92672>=</span> [list(subset) <span style=color:#66d9ef>for</span> subset <span style=color:#f92672>in</span> powerset(high_cards)]
</span></span><span style=display:flex><span>    bestHand <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> potentialHand <span style=color:#f92672>in</span> handPowerset:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> len(potentialHand) <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        suit <span style=color:#f92672>=</span> potentialHand[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>suit()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> all(card<span style=color:#f92672>.</span>suit() <span style=color:#f92672>==</span> suit <span style=color:#66d9ef>for</span> card <span style=color:#f92672>in</span> potentialHand):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> len(potentialHand) <span style=color:#f92672>&gt;</span> len(bestHand):
</span></span><span style=display:flex><span>                bestHand <span style=color:#f92672>=</span> potentialHand
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bestHand
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>drawMissing</span>(deck, hand):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> hand <span style=color:#f92672>+</span> deck<span style=color:#f92672>.</span>draw(<span style=color:#ae81ff>5</span> <span style=color:#f92672>-</span> len(hand))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>isRoyalFlush</span>(hand):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> all(card<span style=color:#f92672>.</span>rank() <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>for</span> card <span style=color:#f92672>in</span> hand):
</span></span><span style=display:flex><span>        suit <span style=color:#f92672>=</span> hand[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>suit()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> all(card<span style=color:#f92672>.</span>suit() <span style=color:#f92672>==</span> suit <span style=color:#66d9ef>for</span> card <span style=color:#f92672>in</span> hand):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>step</span>(deck):
</span></span><span style=display:flex><span>    firstDraw <span style=color:#f92672>=</span> drawInitial(deck)
</span></span><span style=display:flex><span>    holdedCards <span style=color:#f92672>=</span> holdCards(firstDraw)
</span></span><span style=display:flex><span>    secondDraw <span style=color:#f92672>=</span> drawMissing(deck, holdedCards)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> secondDraw
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getNumberOfTries</span>(job):
</span></span><span style=display:flex><span>    i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        i <span style=color:#f92672>=</span> i <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        deck <span style=color:#f92672>=</span> Deck()
</span></span><span style=display:flex><span>        deck<span style=color:#f92672>.</span>shuffle()
</span></span><span style=display:flex><span>        hand <span style=color:#f92672>=</span> step(deck)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> isRoyalFlush(hand):
</span></span><span style=display:flex><span>            print(job, <span style=color:#e6db74>&#34;done&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> i
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>runSimulation</span>(n <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>, numCores <span style=color:#f92672>=</span> multiprocessing<span style=color:#f92672>.</span>cpu_count()):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Run&#34;</span>, n, <span style=color:#e6db74>&#34;simulations on&#34;</span>, numCores, <span style=color:#e6db74>&#34;cores:&#34;</span>)
</span></span><span style=display:flex><span>    results <span style=color:#f92672>=</span> Parallel(n_jobs<span style=color:#f92672>=</span>numCores)(delayed(getNumberOfTries)(i) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, n))
</span></span><span style=display:flex><span>    print(mean(results))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>runSimulation(n <span style=color:#f92672>=</span> <span style=color:#ae81ff>10000</span>)
</span></span></code></pre></div><p><em>Update</em>: In case you come up with a better way, please let me know.</p><p><em>Update</em>: <a href=https://twitter.com/MrSmithVP>@MrSmithVP</a> simulated this already <a href=https://gtaforums.com/topic/886791-video-poker/>here</a> using C++ and a more efficient implementation.</p><p><em>Update</em>: Joshimuz mentioned my blog post in one of his <a href="https://youtu.be/S4Wb8EFN1fU?t=2547">videos</a>. Thanks!</p><p><em>Update</em>: &ldquo;He did it!&rdquo; See comments or <a href=https://reddit.com/r/LivestreamFail/comments/a6opyj/royal_flush_in_gtasa/>this</a> Reddit thread.</p></p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg><script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function topFunction(){smoothScrollToTop()}function smoothScrollToTop(){const e=()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;t>0&&(window.requestAnimationFrame(e),window.scrollTo(0,t-t/8))};e()}</script></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>